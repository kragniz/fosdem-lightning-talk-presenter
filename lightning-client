#!/usr/bin/env python

import sys
import gi

gi.require_version("Gtk", "4.0")
gi.require_version("Adw", "1")
from gi.repository import Gtk, Adw, Gdk, Gio


class MainWindow(Adw.ApplicationWindow):
    def __init__(self, *args, **kwargs):
        super().__init__(title="Slides", *args, **kwargs)

        self.is_fullscreen = False

        evk = Gtk.EventControllerKey.new()
        evk.connect("key-pressed", self.key_press)
        self.add_controller(evk)

    def toggle_fullscreen(self):
        self.is_fullscreen = not self.is_fullscreen
        if self.is_fullscreen:
            self.fullscreen()
        else:
            self.unfullscreen()

    def key_press(self, event, keyval, keycode, state):
        if keyval == Gdk.KEY_q and state & Gdk.ModifierType.CONTROL_MASK:
            self.destroy()
        elif keyval == Gdk.KEY_f and state & Gdk.ModifierType.CONTROL_MASK:
            self.toggle_fullscreen()


class PreviewWindow(Adw.ApplicationWindow):
    def __init__(self, *args, **kwargs):
        super().__init__(title="Preview", *args, **kwargs)


class LightningClient(Adw.Application):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.connect("activate", self.on_activate)

    def on_activate(self, app):
        self.win = MainWindow(application=app)
        self.win.present()

        self.preview_win = PreviewWindow(application=app)
        self.preview_win.present()


app = LightningClient(application_id="org.fosdem.LightningTalkClient")
app.run(sys.argv)
